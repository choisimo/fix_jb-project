# Roboflow 데이터 모델 학습 서비스 PRD (Product Requirements Document)

## 1. 개요

본 문서는 OpenRouter의 Qwen2.5 VL 72B AI 모델을 활용하여 이미지 Vision 분석 및 OCR 자동 라벨링 유효성 검사를 수행하고, 이를 AI 에이전트 라우터의 트랜잭션 라우팅 플로우에 통합하여 Roboflow 데이터 모델 학습을 자동화하는 서비스에 대한 요구사항을 정의합니다. 이 서비스는 데이터 라벨링의 정확성과 효율성을 극대화하고, 학습 데이터셋 구축 과정을 자동화하는 것을 목표로 합니다.

## 2. 목표

*   Qwen2.5 VL 72B 모델을 사용하여 이미지 내 객체 및 텍스트에 대한 고품질 Vision 분석을 수행합니다.
*   Vision 분석 결과를 기반으로 OCR 자동 라벨링의 유효성을 검증하고, 필요한 경우 보정합니다.
*   AI 에이전트 라우터의 트랜잭션 라우팅 플로우를 통해 데이터 처리 및 Roboflow 모델 학습 과정을 통합하고 자동화합니다.
*   Roboflow에 최적화된 학습 데이터셋을 자동으로 구축하고, 모델 학습을 트리거합니다.
*   데이터 라벨링 및 모델 학습 과정의 효율성과 정확성을 향상시킵니다.

## 3. 주요 기능 및 요구사항

### 3.1. Vision 분석 서비스 (Powered by Qwen2.5 VL 72B)

*   **이미지 입력:** Roboflow 학습을 위한 원본 이미지 데이터를 수신합니다.
*   **Qwen2.5 VL 72B 연동:** OpenRouter API(`https://openrouter.ai/qwen/qwen2.5-vl-72b-instruct:free`)를 호출하여 이미지에 대한 Vision 분석을 수행합니다.
    *   객체 감지 (Object Detection): 이미지 내 주요 객체 및 그 위치(바운딩 박스)를 식별합니다.
    *   텍스트 인식 (OCR): 이미지 내 텍스트를 인식하고 그 위치를 파악합니다.
    *   이미지 설명 생성 (Image Captioning): 이미지의 전반적인 내용을 설명하는 텍스트를 생성합니다.
*   **분석 결과 정형화:** Qwen2.5 VL 72B의 분석 결과를 Roboflow 라벨링 형식에 맞게 정형화합니다 (예: JSON, XML).

### 3.2. OCR 자동 라벨링 유효성 검증 서비스

*   **자동 라벨링 입력:** Vision 분석 서비스에서 생성된 OCR 결과(텍스트 및 위치)를 입력받습니다.
*   **유효성 검증 로직:**
    *   Qwen2.5 VL 72B의 이미지 설명 또는 추가적인 Vision 분석을 활용하여 OCR로 인식된 텍스트의 맥락적 정확성을 검증합니다.
    *   예: 도로 표지판 이미지에서 인식된 텍스트가 실제 표지판 내용과 일치하는지, 오타나 오인식 여부 등을 판단합니다.
    *   인식된 텍스트의 바운딩 박스가 실제 텍스트 영역과 정확히 일치하는지 검증합니다.
*   **보정 및 피드백:**
    *   유효성 검증 실패 시, 가능한 경우 자동으로 보정하거나, 수동 검토가 필요한 플래그를 지정합니다.
    *   검증 결과를 Roboflow 학습 데이터셋에 반영할 수 있는 형태로 출력합니다.

### 3.3. AI Agent Router 통합 및 트랜잭션 플로우 적용

*   **트랜잭션 라우팅:** 이전 PRD(`scripts/ai-agent-prd.txt`)에서 정의된 AI 에이전트 라우터의 트랜잭션 플로우를 본 서비스에 적용합니다.
    *   **통합 AI 에이전트:** 원본 이미지 및 관련 메타데이터를 파싱하고, Qwen2.5 VL 72B Vision 분석 서비스 호출을 라우팅합니다.
    *   **유효성 검증 AI 에이전트:** Vision 분석 결과 및 OCR 자동 라벨링 유효성 검증 결과를 검토하여 Roboflow 학습 데이터셋으로의 통합 여부를 결정합니다.
*   **단일 트랜잭션:** 이미지 Vision 분석, OCR 유효성 검증, Roboflow 데이터셋 업데이트 과정이 단일 트랜잭션으로 묶여 원자성(Atomicity)을 보장합니다.

### 3.4. Roboflow 데이터 모델 학습 서비스

*   **데이터셋 구축:** Vision 분석 및 유효성 검증을 거친 이미지와 라벨링 데이터를 Roboflow 학습 데이터셋 형식에 맞게 구성합니다.
*   **Roboflow API 연동:** Roboflow API를 통해 데이터셋을 업로드하고, 지정된 프로젝트 내에서 모델 학습을 트리거합니다.
*   **학습 상태 모니터링:** Roboflow API를 통해 모델 학습 진행 상황 및 결과를 모니터링합니다.
*   **모델 배포 (선택 사항):** 학습 완료된 모델을 Roboflow에서 배포하거나, 배포 가능한 형태로 준비합니다.

## 4. 기술 스택 및 제약사항

*   **Vision AI 모델:** OpenRouter.ai의 `https://openrouter.ai/qwen/qwen2.5-vl-72b-instruct:free` API.
*   **Roboflow 연동:** Roboflow API (Python SDK 또는 REST API).
*   **백엔드 프레임워크:** Spring Boot (Java) 또는 Python (FastAPI/Flask) 기반으로 구현될 수 있습니다.
*   **데이터베이스:** 학습 데이터셋 메타데이터, 학습 이력 등을 저장하기 위해 기존 `database/schema.sql` 또는 NoSQL 데이터베이스 활용.
*   **로깅:** Kafka를 통한 로깅(`documents/feature-kafka-logging-mongodb.md` 참조)을 지원합니다.
*   **트랜잭션 관리:** 분산 트랜잭션 또는 Saga 패턴 고려 (필요시).

## 5. 사용자 시나리오 (User Stories)

*   **시나리오 1: 자동 라벨링 및 모델 학습 성공**
    *   사용자가 손상된 도로 이미지를 업로드하고 Roboflow 학습을 요청합니다.
    *   통합 AI 에이전트가 이미지를 Qwen2.5 VL 72B Vision 분석 서비스로 라우팅합니다.
    *   Vision 분석 서비스가 이미지 내 객체(예: 포트홀)와 텍스트(예: 도로명)를 감지하고 라벨링합니다.
    *   OCR 자동 라벨링 유효성 검증 서비스가 텍스트 라벨링의 정확성을 확인하고 유효하다고 판단합니다.
    *   유효성 검증 AI 에이전트가 모든 과정이 유효함을 확인하고 Roboflow 데이터셋 업데이트를 승인합니다.
    *   Roboflow 데이터 모델 학습 서비스가 업데이트된 데이터셋으로 Roboflow 모델 학습을 트리거하고 성공적으로 완료합니다.

*   **시나리오 2: OCR 자동 라벨링 오류 발생 및 보정**
    *   사용자가 흐릿한 도로 표지판 이미지를 업로드합니다.
    *   Vision 분석 서비스가 텍스트를 인식하지만, OCR 자동 라벨링 유효성 검증 서비스가 인식된 텍스트의 정확도가 낮다고 판단합니다.
    *   유효성 검증 서비스는 해당 라벨에 '수동 검토 필요' 플래그를 지정하고, 가능한 경우 Qwen2.5 VL 72B의 추가 분석을 통해 보정을 시도합니다.
    *   AI 에이전트 라우터는 이 정보를 Roboflow 데이터셋에 반영하고, 수동 검토가 필요한 항목을 표시합니다.

*   **시나리오 3: Vision 분석 실패로 인한 트랜잭션 롤백**
    *   사용자가 지원되지 않는 형식의 이미지를 업로드하거나, Qwen2.5 VL 72B API 호출에 실패합니다.
    *   통합 AI 에이전트 또는 Vision 분석 서비스에서 오류를 감지합니다.
    *   AI 에이전트 라우터의 트랜잭션 관리 로직에 따라 전체 트랜잭션이 롤백되고, 사용자에게 적절한 오류 메시지가 반환됩니다.

## 6. 성공 지표

*   Qwen2.5 VL 72B Vision 분석의 객체 감지 및 OCR 정확도 90% 이상.
*   OCR 자동 라벨링 유효성 검증을 통한 수동 라벨링 필요 비율 50% 감소.
*   Roboflow 모델 학습 데이터셋 구축 자동화율 80% 이상.
*   AI 에이전트 라우터의 트랜잭션 처리 성공률 99.9% 이상.
*   OpenRouter.ai API 호출 비용 효율성 유지.

## 7. 범위 외 (Out of Scope)

*   Qwen2.5 VL 72B 모델 자체의 미세 조정(Fine-tuning).
*   Roboflow 모델 학습 결과의 성능 평가 및 최적화 (본 서비스는 학습 트리거 및 데이터셋 구축에 중점).
*   수동 라벨링 인터페이스 개발.
*   OpenRouter.ai API의 가용성 및 성능 보장.
*   복잡한 데이터 전처리 파이프라인 (Vision 분석 및 유효성 검증 범위 내에서만 처리).
