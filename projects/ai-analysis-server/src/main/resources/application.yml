spring:
  application:
    name: jeonbuk-report-platform
  
  main:
    allow-bean-definition-overriding: true
  
  # Database Configuration (PostgreSQL)
  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    
  # JPA Configuration
  jpa:
    hibernate:
      ddl-auto: none
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
    show-sql: ${SHOW_SQL:false}
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          time_zone: Asia/Seoul
        hbm2ddl:
          auto: none
        globally_quoted_identifiers: false
        globally_quoted_identifiers_skip_column_definitions: true
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    generate-ddl: false
    open-in-view: false
  
  # Redis Configuration
  data:
    redis:
      host: ${REDIS_HOST}
      port: 6379
      password: ${REDIS_PASSWORD}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
  
  # File Upload Configuration
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 200MB
      enabled: true
  
  # Security Configuration
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope: profile,email
          kakao:
            client-id: ${KAKAO_CLIENT_ID}
            client-secret: ${KAKAO_CLIENT_SECRET}
            client-authentication-method: client_secret_post
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope: profile_nickname,account_email
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id

# Application Configuration
app:
  jwt:
    secret: ${JWT_SECRET}
    expiration: 86400000 # 24 hours
    refresh-expiration: 604800000 # 7 days
  
  file:
    upload-dir: ${FILE_STORAGE_PATH}
    max-size: 50MB
    allowed-types: image/jpeg,image/png,image/gif,video/mp4,video/avi
  
  roboflow:
    api-key: ${ROBOFLOW_API_KEY}
    workspace-url: ${ROBOFLOW_WORKSPACE_URL}
  
  openrouter:
    api:
      key: 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
      base-url: https://openrouter.ai/api/v1
      model: openai/gpt-4o
  
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    topics:
      image-requests: ${KAFKA_TOPIC_IMAGE_REQUESTS:image_requests}
      analysis-results: ${KAFKA_TOPIC_ANALYSIS_RESULTS:ai_analysis_results}
      analysis-errors: ${KAFKA_TOPIC_ANALYSIS_ERRORS:ai_analysis_errors}
      validation-results: ${KAFKA_TOPIC_VALIDATION_RESULTS:ai_validation_results}
      notifications: ${KAFKA_TOPIC_NOTIFICATIONS:notifications}

# Google Cloud Configuration
google:
  cloud:
    project-id: ${GOOGLE_CLOUD_PROJECT_ID:}
    vision:
      enabled: false
      credentials-path: ${GOOGLE_APPLICATION_CREDENTIALS:}
    automl:
      enabled: ${GOOGLE_AUTOML_ENABLED:false}
      project-id: ${GOOGLE_AUTOML_PROJECT_ID:}
      location: ${GOOGLE_AUTOML_LOCATION:us-central1}
      classification-model-id: ${GOOGLE_AUTOML_CLASSIFICATION_MODEL_ID:}
      object-detection-model-id: ${GOOGLE_AUTOML_OBJECT_DETECTION_MODEL_ID:}
      confidence-threshold: ${GOOGLE_AUTOML_CONFIDENCE_THRESHOLD:0.7}

# AI Analysis Configuration  
ai:
  analysis:
    enable-automl: ${AI_ENABLE_AUTOML:true}
    enable-rag: ${AI_ENABLE_RAG:true}
    enable-fallback: ${AI_ENABLE_FALLBACK:true}
    confidence-threshold: ${AI_CONFIDENCE_THRESHOLD:0.7}
    parallel-processing: ${AI_PARALLEL_PROCESSING:true}
  agent:
    enabled: true
    api:
      url: https://openrouter.ai/api/v1
      key: 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
      timeout: 30000
    features:
      scene-analysis: true
      object-detection: true
      context-integration: true

# RAG System Configuration
rag:
  context:
    max-chunks: ${RAG_MAX_CONTEXT_CHUNKS:5}
    max-tokens: ${RAG_MAX_CONTEXT_TOKENS:2000}
    chunk-separator: ${RAG_CHUNK_SEPARATOR:---}
    include-metadata: ${RAG_INCLUDE_METADATA:true}
  search:
    similarity-threshold: ${RAG_SIMILARITY_THRESHOLD:0.7}
    max-results: ${RAG_MAX_SEARCH_RESULTS:10}
    rerank-enabled: ${RAG_RERANK_ENABLED:true}
  chunking:
    max-tokens: ${RAG_CHUNKING_MAX_TOKENS:512}
    overlap-tokens: ${RAG_CHUNKING_OVERLAP_TOKENS:50}
  indexing:
    batch-size: ${RAG_INDEXING_BATCH_SIZE:10}
  analysis:
    include-sources: ${RAG_INCLUDE_SOURCES:true}

# OpenAI Configuration (for embeddings)
openai:
  api:
    key: ${OPENAI_API_KEY:}
    base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1}
    embedding-model: ${OPENAI_EMBEDDING_MODEL:text-embedding-ada-002}
    timeout: ${OPENAI_TIMEOUT:30000}

# Async Processing Configuration
async:
  processing:
    core-pool-size: ${ASYNC_CORE_POOL_SIZE:4}
    max-pool-size: ${ASYNC_MAX_POOL_SIZE:8}
    queue-capacity: ${ASYNC_QUEUE_CAPACITY:100}
    timeout: ${ASYNC_TIMEOUT:30000}
    fallback-enabled: ${ASYNC_FALLBACK_ENABLED:true}

# Server Configuration
server:
  port: 8086
  # 컨텍스트 패스 제거 - 테스트 보고서에서 발견된 문제 해결
  #servlet:
  #  context-path: /api/v1
  
# Logging Configuration
logging:
  level:
    com.jeonbuk.report: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: ${SQL_LOG_LEVEL:WARN}
    org.hibernate.type.descriptor.sql.BasicBinder: ${SQL_PARAM_LOG_LEVEL:WARN}
    com.google.cloud: ${GOOGLE_CLOUD_LOG_LEVEL:WARN}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/application.log

# Management Configuration (Actuator)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  info:
    env:
      enabled: true

# SpringDoc (Swagger) Configuration
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
