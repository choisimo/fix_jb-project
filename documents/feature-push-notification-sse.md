## π“Ά μ‹¤μ‹κ°„ μ•λ¦Ό μ‹μ¤ν… κ³ λ„ν™” μ μ•μ„

**ν„ν™© λ¶„μ„:**

ν„μ¬ μ‹μ¤ν…μ€ `flutter_local_notifications`λ¥Ό ν†µν•΄ μ•± λ‚΄ λ΅μ»¬ μ•λ¦Όμ€ κ°€λ¥ν•μ§€λ§, μ„λ²„μ—μ„ μ§μ ‘ ν΄λΌμ΄μ–ΈνΈλ΅ ν‘Έμ‹ μ•λ¦Όμ„ λ³΄λ‚΄λ” κΈ°λ¥κ³Ό κ΄€λ¦¬μ μ›Ή λ€μ‹λ³΄λ“λ¥Ό μ„ν• μ‹¤μ‹κ°„ μ•λ¦Ό κΈ°λ¥μ΄ λ¶€μ¬ν•©λ‹λ‹¤. μ΄λ΅ μΈν•΄ μ‚¬μ©μλ” μ•±μ„ μ‹¤ν–‰ν•΄μ•Όλ§ μƒνƒ λ³€κ²½μ„ μΈμ§€ν•  μ μκ³ , κ΄€λ¦¬μλ” μƒλ΅κ³ μΉ¨μ„ ν†µν•΄ λ³€κ²½μ‚¬ν•­μ„ ν™•μΈν•΄μ•Ό ν•λ” λ¶νΈν•¨μ΄ μμµλ‹λ‹¤.

**μ μ• λ‚΄μ©:**

μ‚¬μ©μ κ²½ν—μ„ κ·Ήλ€ν™”ν•κ³  μ‹¤μ‹κ°„ μƒνΈμ‘μ©μ„ κ°•ν™”ν•κΈ° μ„ν•΄ λ‹¤μ λ‘ κ°€μ§€ κΈ°μ μ„ λ„μ…ν•  κ²ƒμ„ μ μ•ν•©λ‹λ‹¤.

1.  **Firebase Cloud Messaging (FCM) κΈ°λ° μ•± ν‘Έμ‹ μ•λ¦Ό λ„μ…**
2.  **SSE (Server-Sent Events) ν”„λ΅ν† μ½μ„ μ΄μ©ν• μ„λ²„-ν΄λΌμ΄μ–ΈνΈ μ‹¤μ‹κ°„ ν†µμ‹  μ μ©**

### 1. Firebase Cloud Messaging (FCM) λ„μ…

**λ©ν‘:** μ‚¬μ©μκ°€ μ•±μ„ μ‚¬μ©ν•μ§€ μ•μ„ λ•λ„ λ³΄κ³ μ„ μƒνƒ λ³€κ²½(μΉμΈ, λ°λ ¤) λ“± μ¤‘μ” μ—…λ°μ΄νΈλ¥Ό μ¦‰μ‹ μμ‹ ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.

**κΈ°λ€ ν¨κ³Ό:**

*   **μ‹ μ†ν• μ •λ³΄ μ „λ‹¬:** μ‚¬μ©μλ” μ•±μ„ μ—΄μ§€ μ•μ•„λ„ μ¤‘μ” μ•λ¦Όμ„ μ¦‰μ‹ μΈμ§€ν•  μ μμµλ‹λ‹¤.
*   **μ‚¬μ©μ μ°Έμ—¬ μ¦λ€:** ν‘Έμ‹ μ•λ¦Όμ„ ν†µν•΄ μ‚¬μ©μμ μ¬λ°©λ¬Έ λ° μ•± μ°Έμ—¬λ¥Ό μ λ„ν•©λ‹λ‹¤.
*   **μ•μ •μ μΈ λ©”μ‹μ§€ μ „μ†΅:** Googleμ μ•μ •μ μΈ μΈν”„λΌλ¥Ό ν†µν•΄ λ†’μ€ λ©”μ‹μ§€ μ „μ†΅λ¥ μ„ λ³΄μ¥ν•©λ‹λ‹¤.

### 2. SSE (Server-Sent Events) ν”„λ΅ν† μ½ μ μ©

**λ©ν‘:** κ΄€λ¦¬μ μ›Ή λ€μ‹λ³΄λ“μ™€ λ¨λ°”μΌ μ•±μ—μ„ μƒλ΅μ΄ λ³΄κ³ μ„ μ ‘μ, λ“κΈ€ λ“± μ‹¤μ‹κ°„ μ—…λ°μ΄νΈκ°€ ν•„μ”ν• μ •λ³΄λ¥Ό μ¦‰μ‹ λ°μν•©λ‹λ‹¤.

**κΈ°λ€ ν¨κ³Ό:**

*   **μ‹¤μ‹κ°„ λ€μ‹λ³΄λ“ κµ¬ν„:** κ΄€λ¦¬μλ” νμ΄μ§€λ¥Ό μƒλ΅κ³ μΉ¨ν•μ§€ μ•μ•„λ„ μƒλ΅μ΄ λ³΄κ³ μ„ μ ‘μ ν„ν™©μ„ μ‹¤μ‹κ°„μΌλ΅ ν™•μΈν•  μ μμµλ‹λ‹¤.
*   **ν–¥μƒλ μ‚¬μ©μ κ²½ν—:** μ•± μ‚¬μ©μλ” λ³΄κ³ μ„ μƒνƒ λ³€κ²½μ΄λ‚ μƒλ΅μ΄ λ“κΈ€μ„ μ‹¤μ‹κ°„μΌλ΅ ν™•μΈν•μ—¬ μ¦‰κ°μ μΈ μƒνΈμ‘μ©μ΄ κ°€λ¥ν•©λ‹λ‹¤.
*   **ν¨μ¨μ μΈ λ¦¬μ†μ¤ μ‚¬μ©:** WebSocketμ— λΉ„ν•΄ κ°€λ³κ³  κµ¬ν„μ΄ κ°„λ‹¨ν•λ©°, λ‹¨λ°©ν–¥ ν†µμ‹ μ— μµμ ν™”λμ–΄ μ„λ²„ λ¶€ν•λ¥Ό μ¤„μΌ μ μμµλ‹λ‹¤.

### 3. μ μ• μ‹μ¤ν… μ•„ν‚¤ν…μ²

```mermaid
graph TD
    subgraph "Client Applications"
        A[π“± Flutter Mobile App]
        B[π’» Flutter Web App]
    end

    subgraph "Real-time Communication"
        C[π”¥ Firebase Cloud Messaging (FCM)]
        D[π SSE Endpoint (Spring Boot)]
    end

    subgraph "Backend Services"
        E[πƒ Notification Service (Spring Boot)]
        F[πƒ Report Service (Spring Boot)]
    end

    subgraph "Data & Message Layer"
        G[π“¨ Apache Kafka]
    end

    A --"FCM Token λ“±λ΅"--> E
    B --"SSE μ—°κ²° μ”μ²­"--> D

    F --"λ³΄κ³ μ„ μƒνƒ λ³€κ²½ μ΄λ²¤νΈ"--> G
    G --"μ΄λ²¤νΈ μμ‹ "--> E

    E --"ν‘Έμ‹ μ•λ¦Ό μ”μ²­"--> C
    E --"SSE μ΄λ²¤νΈ λ°ν–‰"--> D

    C --"ν‘Έμ‹ μ•λ¦Ό"--> A
    D --"μ‹¤μ‹κ°„ λ°μ΄ν„°"--> B
    D --"μ‹¤μ‹κ°„ λ°μ΄ν„°"--> A
```

**κµ¬ν„ κ³„ν:**

1.  **Backend (Spring Boot):**
    *   `NotificationService`μ— FCM λ° SSE μ§€μ› λ΅μ§ μ¶”κ°€
    *   λ³΄κ³ μ„ μƒνƒ λ³€κ²½ λ“± Kafka μ΄λ²¤νΈλ¥Ό μμ‹ ν•μ—¬ FCM ν‘Έμ‹ μ•λ¦Ό λ° SSE λ©”μ‹μ§€ λ°μ†΅
    *   SSE μ—°κ²°μ„ μ„ν• `/api/v1/notifications/subscribe` μ—”λ“ν¬μΈνΈ κµ¬ν„
2.  **Frontend (Flutter):**
    *   `firebase_messaging` ν¨ν‚¤μ§€ ν™μ„±ν™” λ° μ„¤μ •
    *   μ•± μ‹μ‘ μ‹ FCM ν† ν°μ„ μ„λ²„μ— λ“±λ΅ν•λ” λ΅μ§ μ¶”κ°€
    *   SSE ν΄λΌμ΄μ–ΈνΈλ¥Ό κµ¬ν„ν•μ—¬ μ„λ²„λ΅λ¶€ν„° μ‹¤μ‹κ°„ μ΄λ²¤νΈ μμ‹  λ° UI μ—…λ°μ΄νΈ
3.  **μΈν”„λΌ:**
    *   Firebase ν”„λ΅μ νΈ μ„¤μ • λ° μ•± λ“±λ΅
    *   ν•„μ”μ‹ Nginx λ“± ν”„λ΅μ‹ μ„λ²„μ— SSE μ§€μ› μ„¤μ • μ¶”κ°€

**κ²°λ΅ :**

FCMκ³Ό SSE κΈ°μ μ„ λ„μ…ν•¨μΌλ΅μ¨, μ‚¬μ©μμ™€ κ΄€λ¦¬μ λ¨λ‘μ—κ² **μ‹ μ†ν•κ³  μ›ν™ν• μ‹¤μ‹κ°„ μ •λ³΄ μ „λ‹¬**μ΄ κ°€λ¥ν•΄μ§‘λ‹λ‹¤. μ΄λ” μ „λ¶ ν„μ¥ λ³΄κ³  λ° κ΄€λ¦¬ ν”λ«νΌμ ν•µμ‹¬ κ°€μΉμΈ **μ‹ μ†μ„±**κ³Ό **μ‹¤μ‹κ°„μ„±**μ„ ν¬κ² ν–¥μƒμ‹ν‚¬ κ²ƒμ…λ‹λ‹¤.
