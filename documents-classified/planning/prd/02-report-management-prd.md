# Flutter 신고서 관리 시스템 PRD

## 1. 개요
**목적**: 직관적이고 효율적인 신고서 작성/관리 시스템 구현  
**대상**: 전북 신고 플랫폼 일반 사용자  
**우선순위**: 최고 (Critical)

## 2. 현재 상태
- **기존 구현**: 기본 `CreateReportScreen`, `ReportRepository` 스켈레톤
- **구현률**: 10% (기본 구조만 존재)
- **누락 기능**: 모든 핵심 기능 (작성, 편집, 목록, 상세, 검색, 필터링)

## 3. 상세 요구사항

### 3.1 신고서 작성 화면 (`CreateReportScreen`)
```yaml
필수 입력 항목:
  - 제목 (1-100자)
  - 설명 (10-1000자)
  - 카테고리 (도로, 환경, 안전, 기타)
  - 우선순위 (낮음, 보통, 높음, 긴급)
  - 위치 정보 (GPS 자동/수동 입력)

선택 입력 항목:
  - 사진 첨부 (최대 5장)
  - 연락처 (익명 신고 옵션)
  - 발생 일시 (기본값: 현재)

AI 지원 기능:
  - 이미지 기반 카테고리 자동 분류
  - 제목/설명 자동 생성 제안
  - 유사 신고 중복 검사
  - 위치 기반 관련 신고 표시

UI/UX 요구사항:
  - 단계별 작성 가이드 (3단계)
  - 실시간 글자 수 표시
  - 자동 저장 기능 (30초마다)
  - 임시 저장 / 불러오기
  - 위치 지도 미리보기
```

### 3.2 이미지 첨부 시스템 (`ImageAttachmentWidget`)
```yaml
촬영 기능:
  - 인앱 카메라 (전/후면)
  - 연속 촬영 모드
  - 실시간 필터 (선명도 향상)
  - 플래시 자동/수동 제어

갤러리 기능:
  - 다중 선택 (최대 5장)
  - 이미지 미리보기
  - 크롭/회전 편집
  - EXIF 데이터 표시

이미지 처리:
  - 자동 압축 (1MB 이하)
  - 해상도 최적화 (1920x1080)
  - 워터마크 추가 (선택)
  - 메타데이터 보존/제거 옵션

기술 구현:
  - image_picker: ^1.0.5
  - image_cropper: ^5.0.1
  - path_provider: ^2.1.1
  - photo_manager: ^3.0.0
```

### 3.3 위치 서비스 (`LocationWidget`)
```yaml
GPS 기능:
  - 현재 위치 자동 획득
  - 위치 정확도 표시
  - 수동 위치 선택 (지도)
  - 주소 자동 변환

지도 표시:
  - Google Maps 연동
  - 위치 마커 표시
  - 확대/축소 지원
  - 위성/일반 뷰 전환

주소 관리:
  - 도로명/지번 주소 변환
  - 건물명/상세 주소 입력
  - 최근 위치 기록
  - 즐겨찾는 위치 저장

개인정보 보호:
  - 정확한 위치 숨김 옵션
  - 반경 내 대략적 위치 표시
  - GPS 데이터 암호화
```

### 3.4 신고서 목록 화면 (`ReportListScreen`)
```yaml
목록 표시 옵션:
  - 카드형 목록 (기본)
  - 간단한 목록
  - 지도 위 표시
  - 그리드 뷰 (이미지 중심)

정렬 옵션:
  - 최신 순 (기본)
  - 오래된 순
  - 우선순위 순
  - 거리 순
  - 상태별 그룹화

필터링 기능:
  - 카테고리별 필터
  - 상태별 필터 (접수/처리중/완료)
  - 기간별 필터 (오늘/일주일/한달)
  - 거리별 필터 (1km/5km/10km)
  - 내 신고만 보기

검색 기능:
  - 제목/내용 키워드 검색
  - 위치 기반 검색
  - 태그 검색
  - 고급 검색 (복합 조건)

새로고침:
  - Pull-to-refresh
  - 자동 새로고침 (5분)
  - 실시간 업데이트 (WebSocket)
  - 무한 스크롤 로딩
```

### 3.5 신고서 상세 화면 (`ReportDetailScreen`)
```yaml
기본 정보 표시:
  - 제목, 설명, 카테고리
  - 작성자 정보 (익명 처리 옵션)
  - 작성/수정 일시
  - 처리 상태 및 진행률

이미지 갤러리:
  - 스와이프 이미지 뷰어
  - 확대/축소 지원
  - 이미지 다운로드
  - 이미지 공유 기능

위치 정보:
  - 지도에 위치 표시
  - 주소 정보 표시
  - 길찾기 연동
  - 주변 신고 표시

상호작용 기능:
  - 좋아요/공감 버튼
  - 공유 기능 (SNS, 링크)
  - 북마크 저장
  - 신고하기 (부적절한 내용)

처리 현황:
  - 처리 단계별 타임라인
  - 담당자 배정 현황
  - 예상 완료 일정
  - 처리 결과 첨부파일
```

### 3.6 댓글/후속 조치 시스템 (`CommentSystem`)
```yaml
댓글 기능:
  - 댓글 작성/수정/삭제
  - 답글 기능 (2단계)
  - 댓글 좋아요
  - 댓글 신고 기능

관리자 소통:
  - 공식 답변 표시
  - 처리 상태 업데이트 알림
  - 추가 정보 요청
  - 처리 완료 확인 요청

알림 설정:
  - 댓글 알림 ON/OFF
  - 상태 변경 알림
  - 관리자 메시지 알림
  - 푸시/이메일 선택

실시간 업데이트:
  - WebSocket 연동
  - 실시간 댓글 표시
  - 타이핑 인디케이터
  - 읽음 상태 표시
```

## 4. AI 통합 기능

### 4.1 스마트 작성 도우미
```yaml
이미지 분석:
  - 자동 카테고리 분류
  - 손상 정도 평가
  - 위험도 분석
  - 관련 키워드 추출

텍스트 지원:
  - 제목 자동 생성
  - 설명 보완 제안
  - 맞춤법 검사
  - 감정 톤 분석

중복 검사:
  - 유사 신고 탐지
  - 기존 신고 연결
  - 중복 방지 가이드
  - 통합 신고 제안
```

### 4.2 추천 시스템
```yaml
사용자 맞춤:
  - 자주 신고하는 카테고리
  - 선호하는 신고 방식
  - 활동 지역 기반 추천
  - 시간대별 패턴 분석

콘텐츠 추천:
  - 관련 신고 표시
  - 인근 지역 이슈
  - 트렌딩 신고
  - 시급한 신고 우선 표시
```

## 5. 오프라인 지원

### 5.1 로컬 저장
```yaml
임시 저장:
  - 작성 중인 신고서 자동 저장
  - 오프라인 모드 지원
  - 로컬 이미지 캐싱
  - 동기화 대기열 관리

데이터 동기화:
  - 네트워크 복구 시 자동 업로드
  - 충돌 해결 메커니즘
  - 부분 업로드 지원
  - 오류 시 재시도 로직

캐시 관리:
  - 신고서 목록 캐싱
  - 이미지 캐싱 (LRU)
  - 지도 타일 캐싱
  - 저장소 용량 관리 (최대 500MB)
```

## 6. 접근성 및 다국어

### 6.1 접근성 지원
```yaml
시각 장애인 지원:
  - Screen Reader 호환
  - 고대비 테마
  - 글꼴 크기 조절
  - 음성 안내

청각 장애인 지원:
  - 시각적 알림
  - 진동 알림
  - 수화 동영상 가이드
  - 문자 기반 소통

거동 불편 지원:
  - 한 손 모드
  - 음성 입력
  - 제스처 단순화
  - 큰 터치 영역
```

### 6.2 다국어 지원
```yaml
지원 언어:
  - 한국어 (기본)
  - 영어
  - 중국어 (간체/번체)
  - 일본어

번역 기능:
  - 자동 언어 감지
  - 실시간 번역
  - 번역 품질 표시
  - 원문 보기 옵션
```

## 7. 상태 관리 구조

### 7.1 ReportState
```dart
@freezed
class ReportState with _$ReportState {
  const factory ReportState({
    @Default([]) List<Report> reports,
    @Default(false) bool isLoading,
    @Default(false) bool hasMore,
    ReportFilter? filter,
    String? searchQuery,
    String? error,
  }) = _ReportState;
}
```

### 7.2 ReportNotifier
```dart
class ReportNotifier extends StateNotifier<ReportState> {
  Future<void> loadReports({bool refresh = false});
  Future<void> createReport(CreateReportRequest request);
  Future<void> updateReport(String id, UpdateReportRequest request);
  Future<void> deleteReport(String id);
  Future<void> searchReports(String query);
  void applyFilter(ReportFilter filter);
}
```

## 8. 성능 최적화

### 8.1 이미지 최적화
```yaml
압축 전략:
  - 업로드용: 1MB 이하, JPEG 품질 85%
  - 썸네일: 200KB 이하, 300x300px
  - 미리보기: 500KB 이하, 800x600px

캐싱 전략:
  - 메모리 캐시: 최근 50장
  - 디스크 캐시: 최대 200MB
  - CDN 연동: 빠른 로딩
  - Progressive JPEG: 점진적 로딩
```

### 8.2 목록 성능
```yaml
가상화:
  - 화면에 보이는 항목만 렌더링
  - 무한 스크롤 최적화
  - 이미지 지연 로딩
  - 메모리 사용량 제한

배치 처리:
  - API 요청 배치화
  - 이미지 업로드 병렬 처리
  - 백그라운드 동기화
  - 우선순위 기반 로딩
```

## 9. 보안 요구사항

### 9.1 데이터 보호
```yaml
민감 정보 처리:
  - 위치 정보 암호화
  - 개인 식별 정보 마스킹
  - 이미지 메타데이터 제거
  - 로컬 저장소 암호화

권한 관리:
  - 신고서별 접근 권한
  - 편집 권한 검증
  - 삭제 권한 제한
  - 관리자 전용 기능 분리
```

### 9.2 업로드 보안
```yaml
파일 검증:
  - 파일 타입 검증
  - 악성 코드 스캔
  - 파일 크기 제한
  - 업로드 빈도 제한

통신 보안:
  - HTTPS 강제 사용
  - SSL Pinning
  - Request 서명
  - API 키 보호
```

## 10. 테스트 전략

### 10.1 단위 테스트
- ReportRepository 메서드 테스트
- 이미지 처리 함수 테스트
- 폼 검증 로직 테스트
- 상태 관리 테스트

### 10.2 위젯 테스트
- 신고서 작성 화면 테스트
- 목록 화면 인터랙션 테스트
- 필터링 동작 테스트
- 에러 상태 표시 테스트

### 10.3 통합 테스트
- 전체 신고 플로우 테스트
- 오프라인 모드 테스트
- 파일 업로드 테스트
- 실시간 업데이트 테스트

## 11. 구현 일정

### 주차별 계획
```yaml
1-2주차:
  - 기본 상태 관리 구조
  - 신고서 작성 화면 UI
  - 이미지 첨부 기능
  - 위치 선택 기능

3-4주차:
  - 신고서 목록 화면
  - 검색/필터링 기능
  - 상세 화면 구현
  - 댓글 시스템

5-6주차:
  - AI 통합 기능
  - 오프라인 지원
  - 성능 최적화
  - 접근성 구현

7-8주차:
  - 보안 강화
  - 테스트 작성
  - 버그 수정
  - 문서화 완성
```

**총 구현 기간**: 8주  
**개발자 소요**: 2명 (UI/기능 분담)  
**우선순위**: Critical (앱의 핵심 기능)